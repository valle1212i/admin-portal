<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sök Kund - Source Admin Portal</title>
  <meta name="description" content="Sök efter kunder i Source Admin Portal med avancerade filteralternativ" />
  <link rel="stylesheet" href="/css/search.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <h1>🔍 Sök Kund</h1>
    </header>

    <section class="search-section" aria-labelledby="search-heading">
      <h2 id="search-heading" class="sr-only">Sökfunktion</h2>
      <div class="search-controls">
        <label for="searchInput" class="sr-only">Sök efter kund</label>
        <input type="text" id="searchInput" placeholder="Skriv t.ex. e-post, org.nr, ärende-ID eller info..." aria-describedby="search-help">
        <div id="search-help" class="sr-only">Sök efter e-postadress, organisationsnummer, ärende-ID eller annan kundinformation</div>
        
        <label for="filterSelect" class="sr-only">Välj sökfält</label>
        <select id="filterSelect" aria-label="Välj vilka fält som ska sökas i">
          <option value="all">Alla fält</option>
          <option value="email">E-post</option>
          <option value="orgnr">Organisationsnummer</option>
          <option value="caseId">Ärende-ID</option>
          <option value="caseInfo">Ärendeinfo</option>
        </select>
      </div>
    </section>

    <main class="results-section" aria-labelledby="results-heading">
      <h2 id="results-heading" class="sr-only">Sökresultat</h2>
      <ul id="results" class="results-list" role="list" aria-live="polite" aria-label="Kundsökresultat">
        <!-- Resultat genereras här via JS -->
      </ul>
    </main>
  </div>

  <script>
    const searchInput = document.getElementById("searchInput");
    const filterSelect = document.getElementById("filterSelect");
    const results = document.getElementById("results");

    searchInput.addEventListener("input", async () => {
      const query = searchInput.value.trim();
      const filter = filterSelect.value;

      if (query.length < 2) {
        results.innerHTML = "";
        return;
      }

      const res = await fetch(`/api/customers/search?q=${encodeURIComponent(query)}&filter=${filter}`);
      const data = await res.json();

      results.innerHTML = data.length
        ? data.map(kund => `
            <li class="result-item">
              <h3>${kund.namn || 'Okänd kund'} (${kund._id})</h3>
              <p><strong>📧 Email:</strong> ${kund.email}</p>
              <p><strong>🏢 Org.nr:</strong> ${kund.orgnr || '–'}</p>
              <p><strong>💬 Ärenden:</strong> ${kund.cases?.length || 0}</p>
              <a href="/admin-customer.html?id=${kund._id}" class="btn">Gå till kund</a>
            </li>
          `).join("")
        : "<li class='no-results'>Inga kunder hittades.</li>";
    });
  </script>
</body>
</html>
